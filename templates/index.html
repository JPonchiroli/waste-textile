<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Waste Textile</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
    <main>
        <article id="waste-container" class="grid place-items-center h-screen">
            <form action="/upload" method="POST" enctype="multipart/form-data">
                <div class="flex bg-[#DBEFF7] rounded-2xl w-[880px] h-[520px] overflow-hidden shadow-lg">

                    <input type="file" name="arquivo" id="file-input" class="hidden">

                    <div id="drop-zone"
                        class="w-1/3 bg-[#0A1C36] flex flex-col justify-center items-center p-8 text-center">
                        <h1 class="uppercase text-[#70BFFF] font-[Poppins] font-bold text-3xl mb-6">Selecione Seu
                            Arquivo</h1>

                        <button type="button" id="browse-btn"
                            class="flex items-center justify-center bg-[#F0F8FF] font-semibold py-3 px-6 rounded-2xl w-[220px] h-[70px]  hover:bg-gray-300">
                            <img src="{{ url_for('static', filename='upload-na-nuvem.png') }}" alt="Upload na nuvem"
                                class="w-10 h-10">
                        </button>
                    </div>

                    <div class="w-2/3 bg-[#DBEFF7] p-8 flex flex-col items-center">

                        <div class="text-center mt-[60px]">
                            <h1 class="font-[Poppins] font-extrabold text-3xl">Waste Textile</h1>
                            <h2 class="font-[Poppins] font-medium text-base text-gray-700 mt-2">Preencha o Formulario
                            </h2>
                        </div>

                        <input name="nome"
                            class="bg-[#DFE1ED] rounded-2xl w-[480px] h-[60px] shadow-inner pl-5 placeholder:text-gray-400 placeholder:font-bold mt-[120px]"
                            id="file-name" type="text" placeholder="Nome" disabled>

                        <p id="error-msg" class="text-red-500 text-sm mt-2 hidden">Selecione um arquivo antes de
                            continuar.</p>

                        <button id="btn-submit" type="submit"
                            class="flex items-center justify-center text-white font-[Poppins] font-bold text-xl w-[200px] h-[60px] rounded-full bg-gray-400 uppercase mt-[56px] cursor-not-allowed"
                            disabled>
                            Cadastrar
                        </button>
                    </div>
                </div>
            </form>
        </article>
    </main>

 <script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const browseBtn = document.getElementById('browse-btn');
    const fileNameDisplay = document.getElementById('file-name');
    const submitBtn = document.getElementById('btn-submit');

    // Cria mensagem de erro abaixo do input, se ainda não existir
    let errorMsg = document.getElementById('error-msg');
    if (!errorMsg) {
        errorMsg = document.createElement('p');
        errorMsg.id = 'error-msg';
        errorMsg.className = 'text-red-500 text-sm mt-2 hidden';
        fileNameDisplay.insertAdjacentElement('afterend', errorMsg);
        errorMsg.textContent = "Selecione um arquivo antes de continuar.";
    }

    // Inicializa botão como desabilitado
    submitBtn.disabled = true;
    submitBtn.classList.add("bg-gray-400", "cursor-not-allowed");
    submitBtn.classList.remove("bg-[#284CFF]", "hover:bg-blue-500");

    // Quando o usuário seleciona um arquivo
    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            fileNameDisplay.disabled = false;
            fileNameDisplay.value = fileInput.files[0].name;

            // Habilita botão
            submitBtn.disabled = false;
            submitBtn.classList.remove("bg-gray-400", "cursor-not-allowed");
            submitBtn.classList.add("bg-[#284CFF]", "hover:bg-blue-500");

            // Esconde erro
            errorMsg.classList.add("hidden");
        } else {
            fileNameDisplay.value = "";
            fileNameDisplay.disabled = true;

            // Desabilita botão
            submitBtn.disabled = true;
            submitBtn.classList.add("bg-gray-400", "cursor-not-allowed");
            submitBtn.classList.remove("bg-[#284CFF]", "hover:bg-blue-500");
        }
    });

    // Clique no botão
    submitBtn.addEventListener('click', (e) => {
        e.preventDefault();

        if (fileInput.files.length === 0) {
            errorMsg.classList.remove("hidden"); // mostra mensagem de erro
            return;
        }

        // Redireciona para a próxima página
        window.location.href = "{{ url_for('upload_page') }}";
    });

    // Botão "Procurar arquivo"
    browseBtn.addEventListener('click', () => fileInput.click());

    // Drag & drop
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.classList.add('bg-blue-900');
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('bg-blue-900');
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('bg-blue-900');

        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            fileNameDisplay.value = files[0].name;

            // Habilita botão ao arrastar arquivo
            submitBtn.disabled = false;
            submitBtn.classList.remove("bg-gray-400", "cursor-not-allowed");
            submitBtn.classList.add("bg-[#284CFF]", "hover:bg-blue-500");

            errorMsg.classList.add("hidden");
        }
    });

    // Inicialização
    window.addEventListener("DOMContentLoaded", () => {
        fileNameDisplay.value = "";
        fileNameDisplay.disabled = true;
        fileInput.value = "";
        submitBtn.disabled = true;
    });
</script>

</body>

</html>